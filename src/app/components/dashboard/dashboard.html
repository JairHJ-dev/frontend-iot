<!-- Barra Superior -->
<div class="flex justify-content-between align-items-center bg-primary p-3 shadow-2 mb-3">
    <div class="flex align-items-center gap-2">
        <i class="pi pi-box text-2xl"></i>
        <span class="font-bold text-xl">Sistema IoT</span>
    </div>
    <div class="flex align-items-center gap-3">
        <span class="hidden sm:inline font-medium">Hola, {{usuarioLogueado}}</span>
        <button pButton icon="pi pi-power-off" class="p-button-rounded p-button-danger p-button-text text-white" (click)="logout()"></button>
    </div>
</div>

<div class="grid p-3">
    <!-- Tarjeta Gráfica -->
    <div class="col-12 lg:col-6">
        <p-card header="Monitoreo en Vivo" subheader="Temperatura y Humedad" styleClass="h-full shadow-2">
            <div *ngIf="chartData; else loading">
                <p-chart type="line" [data]="chartData" [options]="chartOptions"></p-chart>
            </div>
            <ng-template #loading>
                <div class="text-center p-4">Cargando datos...</div>
            </ng-template>
        </p-card>
    </div>

    <!-- Tarjeta Tabla -->
    <div class="col-12 lg:col-6">
        <p-card header="Historial Reciente" styleClass="h-full shadow-2">
            <p-table [value]="datos" [rows]="5" [paginator]="true" responsiveLayout="scroll" styleClass="p-datatable-striped">
                <ng-template pTemplate="header">
                    <tr>
                        <th>Fecha</th>
                        <th>Temp</th>
                        <th>Hum</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-dato>
                    <tr>
                        <!-- CORREGIDO: Usamos timestamp_utc con zona horaria UTC para que no reste horas -->
                        <td>{{ dato.timestamp_utc | date:'dd/MM HH:mm:ss':'UTC' }}</td>
                        <td class="font-bold text-orange-500">{{ dato.temp }} °C</td>
                        <td class="font-bold text-blue-500">{{ dato.hum }} %</td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="3">No hay datos aún.</td>
                    </tr>
                </ng-template>
            </p-table>
        </p-card>
    </div>
</div>