<div class="bg-primary p-3 flex justify-content-between align-items-center shadow-2 sticky top-0 z-5">
    <div class="flex align-items-center gap-2">
        <i class="pi pi-box text-xl"></i>
        <span class="font-bold text-lg">IoT Monitor</span>
    </div>
    <p-button icon="pi pi-sign-out" styleClass="p-button-rounded p-button-text text-white" (onClick)="logout()"></p-button>
</div>

<div class="p-3 grid pb-6">
    <div class="col-12">
        <div class="surface-card p-4 shadow-2 border-round">
            <div class="text-900 font-medium text-xl mb-2">Hola, {{usuarioLogueado}}</div>
            <div class="text-600">Resumen de actividad de sensores en tiempo real.</div>
        </div>
    </div>

    <div class="col-12 lg:col-6">
        <p-card header="Tendencia" styleClass="shadow-2 h-full">
            <div *ngIf="chartData; else loadingGraph" style="height: 300px;">
                <p-chart type="line" [data]="chartData" [options]="chartOptions" height="100%"></p-chart>
            </div>
            <ng-template #loadingGraph>
                <div class="flex flex-column align-items-center justify-content-center p-5">
                    <i class="pi pi-spin pi-spinner text-4xl text-primary mb-3"></i>
                    <span class="text-gray-600">Cargando gráfica...</span>
                </div>
            </ng-template>
        </p-card>
    </div>

    <div class="col-12 lg:col-6">
        <p-card header="Últimos Registros" styleClass="shadow-2 h-full">
            <p-table [value]="datos" [rows]="5" [paginator]="true" responsiveLayout="scroll" styleClass="p-datatable-sm p-datatable-striped">
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 40%">Fecha</th>
                        <th style="width: 30%">Temp</th>
                        <th style="width: 30%">Hum</th>
                    </tr>
                </ng-template>
                
                <ng-template pTemplate="body" let-dato>
                    <tr>
                        <td class="text-sm">{{ dato.timestamp_utc | date:'dd/MM HH:mm:ss':'UTC' }}</td>
                        
                        <td><span class="text-orange-500 font-bold">{{ dato.temp }} °C</span></td>
                        <td><span class="text-blue-500 font-bold">{{ dato.hum }} %</span></td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="3" class="text-center p-4">No hay datos registrados aún.</td>
                    </tr>
                </ng-template>
            </p-table>
        </p-card>
    </div>
</div>